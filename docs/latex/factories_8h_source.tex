\hypertarget{factories_8h_source}{}\doxysection{factories.\+h}
\label{factories_8h_source}\index{src/factories.h@{src/factories.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#include\ <memory>}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#include\ "{}fcell.h"{}}}
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ <map>}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00005\ \textcolor{keyword}{namespace\ }hydro}
\DoxyCodeLine{00006\ \{}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ C,\ \textcolor{keyword}{typename}\ V,\ \textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00009\ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classhydro_1_1solution__factory}{solution\_factory}}}
\DoxyCodeLine{00010\ \ \ \ \ \{}
\DoxyCodeLine{00011\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00012\ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }solution\_creator\ =\ std::function<std::unique\_ptr<I\_solution<C,\ V,\ T>>()>;}
\DoxyCodeLine{00013\ \ \ \ \ \ \ \ \ std::unique\_ptr<I\_solution<C,\ V,\ T>>\ create(\textcolor{keyword}{const}\ std::string\ \&name)}
\DoxyCodeLine{00014\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00015\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ \&it\ =\ \_map.find(name);}
\DoxyCodeLine{00016\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it\ !=\ \_map.end())}
\DoxyCodeLine{00017\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00018\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ it-\/>second();}
\DoxyCodeLine{00019\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00020\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00021\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00022\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}Solution\ not\ found!"{}});}
\DoxyCodeLine{00023\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00024\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00025\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ regsiter\_solution(\textcolor{keyword}{const}\ std::string\ \&name,\ solution\_creator\ creator)}
\DoxyCodeLine{00026\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \ \ \ \ \ \ \_map[name]\ =\ std::move(creator);}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ std::shared\_ptr<solution\_factory<C,\ V,\ T>>\ \&factory()}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ \ \ \ \ std::call\_once(}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ only\_one,}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ []()}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classhydro_1_1solution__factory}{solution\_factory<C,\ V,\ T>::\_factory\_instance}}.reset(\textcolor{keyword}{new}\ \mbox{\hyperlink{classhydro_1_1solution__factory}{solution\_factory}}());}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classhydro_1_1solution__factory}{solution\_factory<C,\ V,\ T>::\_factory\_instance}};}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classhydro_1_1solution__factory}{\string~solution\_factory}}()\ \{\ \_map.clear();\ \}}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classhydro_1_1solution__factory}{solution\_factory}}()\ \{\}}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classhydro_1_1solution__factory}{solution\_factory}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classhydro_1_1solution__factory}{solution\_factory<C,\ V,\ T>}}\ \&rs)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classhydro_1_1solution__factory}{solution\_factory}}\ \&operator=(\textcolor{keyword}{const}\ \mbox{\hyperlink{classhydro_1_1solution__factory}{solution\_factory<C,\ V,\ T>}}\ \&rs)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ std::unordered\_map<std::string,\ solution\_creator>\ \_map;}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ std::once\_flag\ only\_one;}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ std::shared\_ptr<solution\_factory<C,\ V,\ T>>\ \_factory\_instance;}
\DoxyCodeLine{00048\ \ \ \ \ \};}
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ C,\ \textcolor{keyword}{typename}\ V,\ \textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00050\ \ \ \ \ std::shared\_ptr<solution\_factory<C,\ V,\ T>>\ \mbox{\hyperlink{classhydro_1_1solution__factory}{solution\_factory<C,\ V,\ T>::\_factory\_instance}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ C,\ \textcolor{keyword}{typename}\ V,\ \textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00052\ \ \ \ \ std::once\_flag\ \mbox{\hyperlink{classhydro_1_1solution__factory}{solution\_factory<C,\ V,\ T>::only\_one}};}
\DoxyCodeLine{00053\ \}}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \textcolor{keyword}{namespace\ }powerhouse}
\DoxyCodeLine{00056\ \{}
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ C>}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classpowerhouse_1_1calculator__factory}{calculator\_factory}}}
\DoxyCodeLine{00059\ \ \ \ \ \{}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }calculator\_creator\ =\ std::function<std::unique\_ptr<I\_calculator<C>>()>;}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ std::unique\_ptr<I\_calculator<C>>\ create(\textcolor{keyword}{const}\ \mbox{\hyperlink{structutils_1_1program__options}{utils::program\_options}}\ \&options)}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structpowerhouse_1_1calculator__key}{calculator\_key}}\ key\{options.program\_mode,\ options.polarization\_mode,\ options.yield\_mode\};}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ \&it\ =\ \_map.find(key);}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it\ !=\ \_map.end())}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ it-\/>second();}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}Calculator\ not\ found!"{}});}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classpowerhouse_1_1calculator__factory}{\string~calculator\_factory}}()\ \{\ \_map.clear();\ \}}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ register\_calculator(\mbox{\hyperlink{structutils_1_1program__options}{utils::program\_options}}\ options,\ calculator\_creator\ creator)}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structpowerhouse_1_1calculator__key}{calculator\_key}}\ key\{options.program\_mode,\ options.polarization\_mode,\ options.yield\_mode\};}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \ \ \ \ \_map[key]\ =\ std::move(creator);}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ std::shared\_ptr<calculator\_factory<C>>\ \&factory()}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \ \ \ \ std::call\_once(}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ only\_one,}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ []()}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classpowerhouse_1_1calculator__factory}{calculator\_factory<C>::\_factory\_instance}}.reset(\textcolor{keyword}{new}\ \mbox{\hyperlink{classpowerhouse_1_1calculator__factory}{calculator\_factory<C>}}());}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classpowerhouse_1_1calculator__factory}{calculator\_factory<C>::\_factory\_instance}};}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classpowerhouse_1_1calculator__factory}{calculator\_factory}}()\ \{\}}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classpowerhouse_1_1calculator__factory}{calculator\_factory}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classpowerhouse_1_1calculator__factory}{calculator\_factory<C>}}\ \&rs)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classpowerhouse_1_1calculator__factory}{calculator\_factory}}\ \&operator=(\textcolor{keyword}{const}\ \mbox{\hyperlink{classpowerhouse_1_1calculator__factory}{calculator\_factory<C>}}\ \&rs)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ std::unordered\_map<calculator\_key,\ calculator\_creator>\ \_map;}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ std::once\_flag\ only\_one;}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ std::shared\_ptr<calculator\_factory<C>>\ \_factory\_instance;}
\DoxyCodeLine{00102\ \ \ \ \ \};}
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ C>}
\DoxyCodeLine{00104\ \ \ \ \ std::shared\_ptr<calculator\_factory<C>>\ \mbox{\hyperlink{classpowerhouse_1_1calculator__factory}{calculator\_factory<C>::\_factory\_instance}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ C>}
\DoxyCodeLine{00106\ \ \ \ \ std::once\_flag\ \mbox{\hyperlink{classpowerhouse_1_1calculator__factory}{calculator\_factory<C>::only\_one}};}
\DoxyCodeLine{00107\ \}}

\end{DoxyCode}
